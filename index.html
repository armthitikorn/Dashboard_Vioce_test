<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <title>р╣Бр╕Ър╕Ър╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕кр╕╡р╕вр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╕Вр╕▓р╕вр╕Ыр╕гр╕░р╕Бр╕▒р╕Щ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background-color: #f9fbff; }
    h1 { text-align: center; }
    .section-title { font-size: 18px; margin-top: 30px; font-weight: bold; color: #333; }
    .question { margin-bottom: 25px; padding: 15px; background-color: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    button { margin: 5px; padding: 6px 12px; }
    a.download-link { display: block; margin-top: 8px; color: #0066cc; text-decoration: none; }
    a.download-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div>
    р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Чр╕│р╣Бр╕Ър╕Ър╕Чр╕Фр╕кр╕нр╕Ъ: <input id="username" placeholder="р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Вр╕нр╕Зр╕Др╕╕р╕У" type="text"/>
  </div>
  <h1>ЁЯОд р╣Бр╕Ър╕Ър╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕кр╕╡р╕вр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╕Вр╕▓р╕вр╕Ыр╕гр╕░р╕Бр╕▒р╕Щ</h1>

  <!-- ЁЯФ╣ р╕Др╕│р╕Цр╕▓р╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф 20 р╕Вр╣Йр╕н -->
  <div class="section-title">р╕Др╕│р╕Цр╕▓р╕бр╕Бр╣Ир╕нр╕Щр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕в (р╕Хр╣Йр╕Щр╕кр╕▓р╕в)</div>
  <div class="question"><label>1. р╕Вр╕нр╕Ър╕Др╕╕р╕Ур╕Др╕гр╕▒р╕Ъ р╣Бр╕Хр╣Ир╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕кр╕Щр╣Гр╕Ир╕Ыр╕гр╕░р╕Бр╕▒р╕Щ</label><br/>
    <button onclick="startRecording(1)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(1)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink1" class="download-link" style="display:none;">ЁЯУе р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╣Ар╕кр╕╡р╕вр╕Зр╕Др╕│р╕Хр╕нр╕Ъ</a>
  </div>
  <div class="question"><label>2. р╕Вр╕нр╣Ар╕зр╕ер╕▓р╕Др╕┤р╕Фр╕Фр╕╣р╕Бр╣Ир╕нр╕Щр╕Др╕гр╕▒р╕Ъ</label><br/>
    <button onclick="startRecording(2)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(2)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink2" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>3. р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕бр╕▒р╕Щр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы</label><br/>
    <button onclick="startRecording(3)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(3)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink3" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>4. р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╕Чр╕▓р╕Зр╕Бр╕▓р╕гр╣Ар╕Зр╕┤р╕Щ</label><br/>
    <button onclick="startRecording(4)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(4)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink4" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>5. р╕Вр╕нр╕Др╕╕р╕вр╕Бр╕▒р╕Ър╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕зр╕Бр╣Ир╕нр╕Щ</label><br/>
    <button onclick="startRecording(5)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(5)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink5" class="download-link" style="display:none;"></a>
  </div>

  <div class="section-title">р╕Др╕│р╕Цр╕▓р╕бр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕в (р╕Бр╕ер╕▓р╕Зр╕кр╕▓р╕в)</div>
  <div class="question"><label>6. р╕Чр╕│р╣Др╕бр╣Ар╕Ър╕╡р╣Йр╕вр╕Цр╕╢р╕Зр╕кр╕╣р╕Зр╕Ир╕▒р╕З</label><br/>
    <button onclick="startRecording(6)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(6)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink6" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>7. р╕Йр╕▒р╕Щр╕Бр╕ер╕▒р╕зр╕зр╣Ир╕▓р╕Ър╕гр╕┤р╕йр╕▒р╕Чр╕Ир╕░р╣Др╕бр╣Ир╕бр╕▒р╣Ир╕Щр╕Др╕З</label><br/>
    <button onclick="startRecording(7)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(7)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink7" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>8. р╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Ър╕нр╕Бр╕зр╣Ир╕▓р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Др╕бр╣Ир╕Др╕╕р╣Йр╕б</label><br/>
    <button onclick="startRecording(8)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(8)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink8" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>9. р╕Чр╕│р╣Др╕бр╕Хр╣Йр╕нр╕Зр╕Чр╕│р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╣Ар╕ер╕в</label><br/>
    <button onclick="startRecording(9)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(9)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink9" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>10. р╕Йр╕▒р╕Щр╕бр╕╡р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з</label><br/>
    <button onclick="startRecording(10)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(10)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink10" class="download-link" style="display:none;"></a>
  </div>

  <div class="section-title">р╕Др╕│р╕Цр╕▓р╕бр╕лр╕ер╕▒р╕Зр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕в (р╕Чр╣Йр╕▓р╕вр╕кр╕▓р╕в)</div>
  <div class="question"><label>11. р╕Цр╣Йр╕▓р╣Ар╕Бр╕┤р╕Фр╕нр╕░р╣Др╕гр╕Вр╕╢р╣Йр╕Щ р╕Йр╕▒р╕Щр╕Ир╕░р╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╣Гр╕Др╕г</label><br/>
    <button onclick="startRecording(11)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(11)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink11" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>12. р╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╕Щр╕╡р╣Йр╕Др╕╕р╣Йр╕бр╕Др╕гр╕нр╕Зр╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕З</label><br/>
    <button onclick="startRecording(12)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(12)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink12" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>13. р╕Цр╣Йр╕▓р╕Йр╕▒р╕Щр╕Ир╣Ир╕▓р╕вр╣Др╕бр╣Ир╣Др╕лр╕зр╕Ир╕░р╣Ар╕Бр╕┤р╕Фр╕нр╕░р╣Др╕гр╕Вр╕╢р╣Йр╕Щ</label><br/>
    <button onclick="startRecording(13)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(13)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink13" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>14. р╕Цр╣Йр╕▓р╕Йр╕▒р╕Щр╣Ар╕кр╕╡р╕вр╕Кр╕╡р╕зр╕┤р╕Хр╣Ар╕гр╣Зр╕з р╣Гр╕Др╕гр╕Ир╕░р╣Др╕Фр╣Йр╕Ьр╕ер╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М</label><br/>
    <button onclick="startRecording(14)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(14)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink14" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>15. р╕Йр╕▒р╕Щр╕Ир╕░р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╣Др╕Фр╣Йр╣Др╕лр╕б</label><br/>
    <button onclick="startRecording(15)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(15)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink15" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>16. р╕Цр╣Йр╕▓р╕бр╕╡р╣Вр╕гр╕Др╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╕Ир╕░р╕кр╕бр╕▒р╕Др╕гр╣Др╕Фр╣Йр╣Др╕лр╕б</label><br/>
    <button onclick="startRecording(16)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(16)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink16" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>17. р╣Гр╕Кр╣Йр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕ер╕Фр╕лр╕вр╣Ир╕нр╕Щр╕ар╕▓р╕йр╕╡р╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И</label><br/>
    <button onclick="startRecording(17)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(17)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink17" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>18. р╕бр╕╡р╣Бр╕Ьр╕Щр╕Чр╕╡р╣Ир╣Ар╕Ър╕╡р╣Йр╕вр╕Цр╕╣р╕Бр╕Бр╕зр╣Ир╕▓р╕Щр╕╡р╣Йр╣Др╕лр╕б</label><br/>
    <button onclick="startRecording(18)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(18)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink18" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>19. р╕Йр╕▒р╕Щр╣Др╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕кр╕▒р╕Нр╕Нр╕▓р╣Ар╕ер╕в</label><br/>
    <button onclick="startRecording(19)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(19)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink19" class="download-link" style="display:none;"></a>
  </div>
  <div class="question"><label>20. р╕Чр╕│р╣Др╕бр╕Хр╣Йр╕нр╕Зр╕Лр╕╖р╣Йр╕нр╕Бр╕▒р╕Ър╕Др╕╕р╕У</label><br/>
    <button onclick="startRecording(20)">тЦ╢я╕П р╣Ар╕гр╕┤р╣Ир╕бр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <button onclick="stopRecording(20)">тП╣я╕П р╕лр╕вр╕╕р╕Фр╕нр╕▒р╕Фр╣Ар╕кр╕╡р╕вр╕З</button>
    <a id="downloadLink20" class="download-link" style="display:none;"></a>
  </div>

  <!-- р╕Ыр╕╕р╣Ир╕бр╕гр╕зр╕б -->
  <button id="downloadAllBtn">ЁЯУе р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣Мр╣Ар╕кр╕╡р╕вр╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (ZIP)</button>
  <hr>
  <h2>ЁЯУВ р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╣Ар╕кр╕╡р╕вр╕Зр╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф</h2>
  <ul id="fileList"></ul>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getStorage, ref, uploadBytes, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-storage.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA4OrZERUoxWPiShCEWVvz1MK9cYGO3_K8",
      authDomain: "new-record-3ccd6.firebaseapp.com",
      projectId: "new-record-3ccd6",
      storageBucket: "new-record-3ccd6.appspot.com",
      messagingSenderId: "1065863160189",
      appId: "1:1065863160189:web:25313e55b0733f5e126c14",
      measurementId: "G-JW6N2HYR58"
    };
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    let recorders = [], audioChunksList = [];
    const fileListElement = document.getElementById('fileList');

    window.startRecording = async function(index) {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const recorder = new MediaRecorder(stream);
        const audioChunks = [];
        recorder.ondataavailable = e => audioChunks.push(e.data);
        recorder.start();
        recorders[index] = recorder;
        audioChunksList[index] = audioChunks;
      } catch (error) { alert("тЪая╕П р╣Вр╕Ыр╕гр╕Фр╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Др╕бр╣Вр╕Др╕гр╣Вр╕Яр╕Щ"); }
    };

    window.stopRecording = function(index) {
      const recorder = recorders[index], audioChunks = audioChunksList[index];
      if (!recorder) return;
      recorder.stop();
      recorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const username = document.getElementById("username").value || "anonymous";
        const audioFileName = `${username}_answer_${index}.webm`;
        const storageRef = ref(storage, 'answers/' + audioFileName);

        try {
          await uploadBytes(storageRef, audioBlob);
          await addDoc(collection(db, "recordings"), {
            fileName: audioFileName,
            username: username,
            questionIndex: index,
            timestamp: new Date().toISOString()
          });

          const audioUrl = URL.createObjectURL(audioBlob);
          const downloadLink = document.getElementById('downloadLink' + index);
          downloadLink.href = audioUrl;
          downloadLink.download = audioFileName;
          downloadLink.textContent = 'ЁЯУе р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Фр╣Ар╕кр╕╡р╕вр╕Зр╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣И ' + index;
          downloadLink.style.display = 'block';
          fetchAndDisplayFiles();
        } catch (e) { alert("тЭМ р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И: " + e.message); }
      };
    };

    async function fetchAndDisplayFiles() {
      fileListElement.innerHTML = '';
      try {
        const listRef = ref(storage, 'answers/');
        const res = await listAll(listRef);
        if (res.items.length === 0) {
          fileListElement.innerHTML = '<li>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╣Др╕Яр╕ер╣Мр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф</li>'; return;
        }
        for (const itemRef of res.items) {
          const url = await getDownloadURL(itemRef);
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = url; a.textContent = itemRef.name; a.target = "_blank";
          li.appendChild(a); fileListElement.appendChild(li);
        }
      } catch (e) { console.error("р╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣Мр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з:", e); }
    }
    fetchAndDisplayFiles();

    document.getElementById("downloadAllBtn").onclick = async () => {
      const zip = new JSZip();
      const username = document.getElementById("username").value || "anonymous";
      try {
        const listRef = ref(storage, 'answers/');
        const res = await listAll(listRef);
        for (const itemRef of res.items) {
          const url = await getDownloadURL(itemRef);
          const response = await fetch(url);
          const blob = await response.blob();
          zip.file(itemRef.name, blob);
        }
        const content = await zip.generateAsync({ type: "blob" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(content);
        a.download = username + "_voice_answers.zip";
        a.click();
      } catch (e) { alert("тЭМ ZIP р╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: " + e.message); }
    };
  </script>
</body>
</html>





